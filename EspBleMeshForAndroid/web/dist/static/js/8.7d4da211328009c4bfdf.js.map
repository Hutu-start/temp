{"version":3,"sources":["webpack:///src/pages/capabilities.vue","webpack:///./src/pages/capabilities.vue?8b9e","webpack:///./src/pages/capabilities.vue"],"names":["capabilities","data","blueEnable","isBleScan","locationGranted","locationEnabled","deviceName","networkKey","flag","oobMethods","deviceId","proxyAddress","connectContent","connectData","capabilitiesTimeOut","created","self","this","window","res","scanCallback","provisioningCallback","connectCallback","onBackPressed","methods","extends_default","Object","vuex_esm","setNum","getOobMethods","item","constant_default","a","NO_OOB_AUTHENTICATION","STATIC_OOB_AUTHENTICATION","OUTPUT_OOB_AUTHENTICATION","INPUT_OOB_AUTHENTICATION","provision","provisionData","name","oobMethod","console","log","stringify_default","mint_ui_common","open","setTimeout","close","messageRemind","$t","EspBleMesh","startProvisioning","deviceProvision","utils","_isEmpty","length","showBlueFail","hide","disconnect","$router","goBack","deviceNameClick","prompt","inputValue","inputPlaceholder","inputValidator","v","stringToBytes","inputErrorMessage","confirmButtonText","cancelButtonText","then","obj","value","catch","err","networkKeyClick","homeDeviceScan","startScan","type","msg","message","position","base64","decode","JSON","parse","stopScan","i","address","id","$store","commit","connect","sort","sortBy","status","STATUS_GATT_CONNECTED","STATUS_GATT_DISCONNECTED","STATUS_PROXY_READY","STATUS_PROVISIONING_COMPLETE","clearTimeout","node","$type","title","showConfirmButton","closeOnClickModal","showCancelButton","action","removeDevices","backHome","STATUS_FAILED","scanDeviceList","state","scanProvisioning","forEach","splice","goRight","query","CAPABILITIES","mounted","$route","computed","number","home","getBlueEnable","blueInfo","pages_capabilities","render","_vm","_h","$createElement","_c","_self","staticClass","on","click","_v","_s","directives","rawName","expression","$event","_l","stopPropagation","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/8.7d4da211328009c4bfdf.js","sourcesContent":["<template>\r\n  <div class=\"content-box\">\r\n    <div class=\"title-info\">\r\n      <h4 class=\"app-title\"><span @click=\"hide\"><i class=\"icon-left back\"></i></span>{{$t('capabilities')}}</h4>\r\n      <div v-show=\"!getBlueEnable\"  @click=\"showBlueFail\" class=\"bluetooth-second-base\">\r\n        <i class=\"icon-bluetooth bluetooth-second-style\"></i>\r\n      </div>\r\n      <span @click=\"deviceProvision()\" class=\"right-top-text\">{{$t('provision')}}</span>\r\n      <ul v-show=\"flag\" class=\"add-ul add-provision-ul\">\r\n        <!--        <i class=\"icon-light\"></i>-->\r\n        <li v-for=\"(item, i) in oobMethods\" @click.stop=\"provision(i)\"><span>{{getOobMethods(item)}}</span></li>\r\n<!--        <li @click.stop=\"provision('2')\"><span>{{$t('fastprovision')}}</span></li>-->\r\n      </ul>\r\n    </div>\r\n    <div class=\"device-detail\">\r\n      <!--        设备名称-->\r\n      <div @click=\"deviceNameClick\" class=\"item\">\r\n        <span class=\"name\">{{$t('devicename')}}</span>\r\n        <span class=\"content\">{{deviceName}}</span>\r\n        <i class=\"icon-right text-color\"></i>\r\n      </div>\r\n      <!--        Network Key-->\r\n      <div @click=\"networkKeyClick\" class=\"item\">\r\n        <span class=\"name\">{{$t('networkkey')}}</span>\r\n        <span class=\"content\">{{networkKey}}</span>\r\n<!--        <i class=\"icon-right text-color\"></i>-->\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {mapMutations, mapGetters, mapState} from 'vuex'\r\n  import {MessageBox, Toast, Indicator} from 'mint-ui'\r\n  import Util from '../assets/tool/utils'\r\n  import Constant from '../assets/tool/constant'\r\n  export default {\r\n    data () {\r\n      return {\r\n        blueEnable: false,\r\n        isBleScan: true,\r\n        locationGranted: true,\r\n        locationEnabled: true,\r\n        deviceName: '',\r\n        networkKey: 'Primary Network Key',\r\n        flag: false,\r\n        oobMethods: [],\r\n        deviceId: '',\r\n        proxyAddress: '',\r\n        connectContent: 0,\r\n        connectData: '',\r\n        capabilitiesTimeOut: ''\r\n      }\r\n    },\r\n    created: function () {\r\n      const self = this\r\n      window['scanCallback'] = (res) => {\r\n        self.scanCallback(res)\r\n      }\r\n      window['provisioningCallback'] = (res) => {\r\n        self.provisioningCallback(res)\r\n      }\r\n      window['connectCallback'] = (res) => {\r\n        self.connectCallback(res)\r\n      }\r\n      window['onBackPressed'] = () => {\r\n        self.onBackPressed()\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapMutations({\r\n        setNum: 'SET_NUM'\r\n      }),\r\n      getOobMethods (item) {\r\n        if (item === Constant.NO_OOB_AUTHENTICATION) {\r\n          return 'No OOB'\r\n        } else if (item === Constant.STATIC_OOB_AUTHENTICATION) {\r\n          return 'Static OOB'\r\n        } else if (item === Constant.OUTPUT_OOB_AUTHENTICATION) {\r\n          return 'Output OOB'\r\n        } else if (item === Constant.INPUT_OOB_AUTHENTICATION) {\r\n          return 'Input OOB'\r\n        }\r\n      },\r\n      provision (item) {\r\n        var self = this\r\n        self.flag = false\r\n        var provisionData = {'name': self.deviceName, 'oobMethod': self.oobMethods[item]}\r\n        console.log('选择配网类型： ' + item + '配网参数： ' + JSON.stringify(provisionData))\r\n        Indicator.open()\r\n        self.capabilitiesTimeOut = setTimeout(function () {\r\n          Indicator.close()\r\n          self.messageRemind(self.$t('provisionTimeout'))\r\n        }, 6000)\r\n        EspBleMesh.startProvisioning(JSON.stringify(provisionData))\r\n      },\r\n      deviceProvision () {\r\n        var self = this\r\n        console.log('blueEnable:' + this.blueEnable + '  locationEnabled:' + this.locationEnabled + '  locationGranted:' + this.locationGranted)\r\n        if (!self.blueEnable) {\r\n          self.messageRemind(self.$t('notbluetooth'))\r\n          return\r\n        }\r\n        if (!self.locationEnabled) {\r\n          self.messageRemind(self.$t('notlocation'))\r\n          return\r\n        }\r\n        if (!self.locationGranted) {\r\n          self.messageRemind(self.$t('notgps'))\r\n          return\r\n        }\r\n        if (Util._isEmpty(self.oobMethods)){\r\n          return\r\n        }\r\n        if (self.oobMethods.length === 1) {\r\n          console.log('选择配网类型' + self.oobMethods[0])\r\n          self.provision(0)\r\n        }else {\r\n          self.flag = true\r\n        }\r\n      },\r\n      showBlueFail () {\r\n        console.log('点击蓝牙按钮')\r\n      },\r\n      hide () {\r\n        EspBleMesh.disconnect()\r\n        this.flag = false\r\n        this.$router.goBack()\r\n      },\r\n      deviceNameClick () {\r\n        var self = this\r\n        console.log('点击编辑设备名称')\r\n        MessageBox.prompt(self.$t('devicename'), {inputValue: self.deviceName, inputPlaceholder: self.$t('devicename'),\r\n            inputValidator:function(v){if (Util.stringToBytes(v).length > 32){return false} {}},\r\n            inputErrorMessage: self.$t('longDesc'),\r\n            confirmButtonText: self.$t('confirmBtn'), cancelButtonText: self.$t('cancelBtn')}).then(function(obj) {\r\n              self.deviceName = obj.value;\r\n        }).catch(function(err) {\r\n          // self.onBackIndex();\r\n        });\r\n      },\r\n      networkKeyClick () {\r\n        console.log('点击选择密钥')\r\n      },\r\n      onBackPressed () {\r\n        EspBleMesh.disconnect()\r\n        this.flag = false\r\n        this.$router.goBack()\r\n      },\r\n      homeDeviceScan () {\r\n        var self = this\r\n        console.log('homeDeviceScan 123')\r\n        if (!self.blueEnable) {\r\n          self.messageRemind(self.$t('notbluetooth'))\r\n        }\r\n        if (!self.locationEnabled) {\r\n          self.messageRemind(self.$t('notlocation'))\r\n        }\r\n        if (!self.locationGranted) {\r\n          self.messageRemind(self.$t('notgps'))\r\n        }\r\n        if (self.blueEnable && self.locationEnabled && self.locationGranted) {\r\n          console.log('home 开始 proxy 蓝牙扫描')\r\n          var scanData = {'type':'proxy'}\r\n          EspBleMesh.startScan(JSON.stringify(scanData))\r\n        }\r\n      },\r\n      messageRemind (msg) {\r\n        Toast({\r\n          message: msg,\r\n          position: 'bottom'\r\n        })\r\n      },\r\n      scanCallback (res) {\r\n        var self = this\r\n        res = Util.base64().decode(res)\r\n        console.log('Home scan proxy device: ' + res)\r\n        res = JSON.parse(res)\r\n        if (!Util._isEmpty(res)) {\r\n          EspBleMesh.stopScan()\r\n          for (let i = 0; i < res.length; ++i) {\r\n            if (res[i].address === self.proxyAddress) {\r\n              self.connectData = {'id': res[i].id, 'type': 'proxy', 'address': self.proxyAddress}\r\n              console.log('FBY home connectData: ' + JSON.stringify(self.connectData))\r\n              self.$store.commit('setBleConnectAddress', self.proxyAddress)\r\n              EspBleMesh.connect(JSON.stringify(self.connectData))\r\n              return\r\n            }\r\n          }\r\n          res.sort(Util.sortBy(\"rssi\"));\r\n          self.connectData = {'id': res[0].id, 'type': 'proxy', 'address': self.proxyAddress}\r\n          console.log('FBY home connectData: ' + JSON.stringify(self.connectData))\r\n          self.$store.commit('setBleConnectAddress', self.proxyAddress)\r\n          EspBleMesh.connect(JSON.stringify(self.connectData))\r\n        }\r\n      },\r\n      connectCallback (res) {\r\n        var self = this\r\n        res = Util.base64().decode(res)\r\n        console.log('FBY connectCallback' + res)\r\n        res = JSON.parse(res)\r\n        if (!Util._isEmpty(res)) {\r\n          switch(res.status) {\r\n            case Constant.STATUS_GATT_CONNECTED:\r\n              console.log('设备蓝牙连接成功 12345678900987654321')\r\n              self.$store.commit('setIsBleConnect', true)\r\n              self.connectContent = 0\r\n              break\r\n            case Constant.STATUS_GATT_DISCONNECTED:\r\n              if (self.connectContent < 2) {\r\n                if (!Util._isEmpty(self.connectData)) {\r\n                  EspBleMesh.connect(JSON.stringify(self.connectData))\r\n                }\r\n              }\r\n              self.connectContent ++\r\n              break\r\n            case Constant.STATUS_PROXY_READY:\r\n              console.log('设备详情获取成功：' + res)\r\n              self.connectContent = 0\r\n              break\r\n          }\r\n        }\r\n      },\r\n      provisioningCallback (res) {\r\n        var self = this\r\n        res = Util.base64().decode(res)\r\n        console.log('FBY provisioningCallback' + res)\r\n        res = JSON.parse(res)\r\n        if (!Util._isEmpty(res)) {\r\n          if (res.status === Constant.STATUS_PROVISIONING_COMPLETE) {\r\n            clearTimeout(self.capabilitiesTimeOut)\r\n            self.$store.commit('setSigProvisionList', res.node)\r\n            self.proxyAddress = res.node.address\r\n            self.homeDeviceScan()\r\n            setTimeout(function () {\r\n              Indicator.close()\r\n              MessageBox({\r\n                $type: 'alert',\r\n                title: self.$t('success'),\r\n                message: self.$t('provisioningcomplete'),\r\n                showConfirmButton: false,\r\n                closeOnClickModal: false,\r\n                showCancelButton: true,\r\n                cancelButtonText: self.$t('confirmBtn')\r\n              }).then(action => {\r\n                console.log('点击确定按钮')\r\n                self.removeDevices()\r\n                self.backHome(res.node)\r\n              })\r\n            }, 2000)\r\n          } else if (res.status === Constant.STATUS_FAILED) {\r\n            console.log('capabilities STATUS_FAILED')\r\n          }\r\n        }\r\n      },\r\n      removeDevices () {\r\n        var self = this\r\n        var scanDeviceList = self.$store.state.scanProvisioning\r\n        scanDeviceList.forEach(function (item, i) {\r\n          if (item.id === self.deviceId) {\r\n            scanDeviceList.splice(i, 1);\r\n            return false;\r\n          }\r\n        })\r\n        self.$store.commit('setScanProvisioning', scanDeviceList)\r\n      },\r\n      backHome (node) {\r\n        var self = this\r\n        self.$router.goRight({\r\n          name: 'home',\r\n          query: {\r\n            node: node,\r\n            type: Constant.CAPABILITIES\r\n          }\r\n        })\r\n      }\r\n    },\r\n    mounted () {\r\n      this.connectContent = 0\r\n      console.log('sigprovision 传参打印' + JSON.stringify(this.$route.query))\r\n      this.deviceName = this.$route.query.name\r\n      this.oobMethods = this.$route.query.oobMethods\r\n      this.deviceId = this.$route.query.deviceId\r\n    },\r\n    computed: {\r\n      ...mapGetters([\r\n        'number'\r\n      ]),\r\n      ...mapState({\r\n        number: state => state.home.number\r\n      }),\r\n      getBlueEnable () {\r\n        this.blueEnable = this.$store.state.blueInfo\r\n        this.locationGranted = this.$store.state.locationGranted\r\n        this.locationEnabled = this.$store.state.locationEnabled\r\n        return this.blueEnable\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  @import '../assets/css/index.less';\r\n  .device-detail {\r\n     margin: 70px 30px;\r\n     border: 1px solid @tab-general-bg-color;\r\n   }\r\n  .device-detail .item {\r\n    display: flex;\r\n    height: 45px;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    padding: 0 10px;\r\n  }\r\n  .device-detail .name {\r\n    flex: 1;\r\n  }\r\n  .device-detail .content {\r\n    color: @Secondary-font-color;\r\n    margin-right: 10px;\r\n  }\r\n  .text-color {\r\n    color: @Secondary-font-color;\r\n    font-size: 12px;\r\n  }\r\n  .add-provision-ul {\r\n    top: 50px !important;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/capabilities.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content-box\"},[_c('div',{staticClass:\"title-info\"},[_c('h4',{staticClass:\"app-title\"},[_c('span',{on:{\"click\":_vm.hide}},[_c('i',{staticClass:\"icon-left back\"})]),_vm._v(_vm._s(_vm.$t('capabilities')))]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.getBlueEnable),expression:\"!getBlueEnable\"}],staticClass:\"bluetooth-second-base\",on:{\"click\":_vm.showBlueFail}},[_c('i',{staticClass:\"icon-bluetooth bluetooth-second-style\"})]),_vm._v(\" \"),_c('span',{staticClass:\"right-top-text\",on:{\"click\":function($event){return _vm.deviceProvision()}}},[_vm._v(_vm._s(_vm.$t('provision')))]),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.flag),expression:\"flag\"}],staticClass:\"add-ul add-provision-ul\"},_vm._l((_vm.oobMethods),function(item,i){return _c('li',{on:{\"click\":function($event){$event.stopPropagation();return _vm.provision(i)}}},[_c('span',[_vm._v(_vm._s(_vm.getOobMethods(item)))])])}),0)]),_vm._v(\" \"),_c('div',{staticClass:\"device-detail\"},[_c('div',{staticClass:\"item\",on:{\"click\":_vm.deviceNameClick}},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.$t('devicename')))]),_vm._v(\" \"),_c('span',{staticClass:\"content\"},[_vm._v(_vm._s(_vm.deviceName))]),_vm._v(\" \"),_c('i',{staticClass:\"icon-right text-color\"})]),_vm._v(\" \"),_c('div',{staticClass:\"item\",on:{\"click\":_vm.networkKeyClick}},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.$t('networkkey')))]),_vm._v(\" \"),_c('span',{staticClass:\"content\"},[_vm._v(_vm._s(_vm.networkKey))])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-48c9fc86\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/capabilities.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-48c9fc86\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./capabilities.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./capabilities.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./capabilities.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-48c9fc86\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./capabilities.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-48c9fc86\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/capabilities.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}
{"version":3,"sources":["webpack:///src/pages/OTAUpgrade.vue","webpack:///./src/pages/OTAUpgrade.vue?5f3f","webpack:///./src/pages/OTAUpgrade.vue"],"names":["OTAUpgrade","data","deviceInfo","this","$store","state","upgradeBinList","isSelectedVersion","isSelectedBin","upgrade","upgradeValue","upgradeSuccess","upgradeFailure","timeCost","timeCostId","scheduleId","created","self","window","res","getOtaBinsCallback","onBackPressed","otaCallback","onActivityPause","onActivityResume","getWiFiInfoCallback","methods","hide","$router","goBack","console","log","EspBleMesh","getWiFiInfo","sendOTAStartData","utils","base64","decode","JSON","parse","_isEmpty","otawifiName","ssid","constant_default","a","KEY_NAME","name","KEY_COMPANY_ID","VALUE_COMPANY_ID","KEY_BIN_ID","binId","KEY_VERSION_CODE","versionCode","stringify_default","startOta","messageRemind","$t","nodeUpgrade","sendOTAMeshData","KEY_DST_ADDRESS","address","KEY_CLEAR_FLASK","sendOtaMeshMessage","setSchedule","setInterval","clearInterval","stopTime","document","getElementById","innerText","style","width","hideUpgrade","stopUpgrade","getBinName","retrySave","otaReboot","getTime","time","getSecond","m","toFixed","s","getMinute","h","getHour","second","minute","switchUpgradeBin","item","isUpgradeSelected","flag","status","OTA_STATUS_MESSAGE_NOT_NEED","OTA_STATUS_MESSAGE_TIMEOUT","OTA_STATUS_MESSAGE_READY","commit","Object","mint_ui_common","$type","title","message","password","showConfirmButton","closeOnClickModal","showCancelButton","cancelButtonText","then","action","gotoSystemSettings","OTA_STATUS_COMPLETE","OTA_STATUS_CONNECTED","OTA_STATUS_PROGRESS","progress","mounted","getOtaBins","activated","pages_OTAUpgrade","render","_vm","_h","$createElement","_c","_self","staticClass","on","click","_v","_s","$event","_l","key","versionName","class","active","attrs","data-value","directives","rawName","value","expression","left","id","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/7.596196084e8cf50b5496.js","sourcesContent":["<template>\r\n  <div class=\"content-box\">\r\n    <div class=\"title-info\">\r\n      <h4 class=\"app-title\"><span @click=\"hide\"><i class=\"icon-left back\"></i></span>{{deviceInfo.name}}</h4>\r\n      <span @click=\"nodeUpgrade()\" class=\"right-top-text\">{{$t('upgrade')}}</span>\r\n    </div>\r\n    <div class=\"content-info flex-wrapper upgrade-base\">\r\n      <div class=\"overflow-touch\">\r\n        <div v-for=\"item in upgradeBinList\" :key=\"item.name\" @click=\"switchUpgradeBin(item)\" class=\"item\">\r\n          <div class=\"item-name\">\r\n            <span>{{item.name}}</span>\r\n            <span class=\"desc\">{{item.versionName}}</span>\r\n          </div>\r\n          <div class=\"item-power-small\">\r\n            <span :data-value=\"item.name\" class=\"span-radio\" :class=\"{'active': isUpgradeSelected(item.name)}\"><span></span></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div v-show=\"upgrade\" class=\"ota-upgrade\">\r\n      <div @click=\"hideUpgrade\" class=\"mask\"></div>\r\n      <div class=\"upgrade-info\">\r\n        <h3>{{$t('otaUpdate')}}</h3>\r\n        <div class=\"progress-info\">\r\n          <span :style=\"{'left': upgradeValue + '%'}\" class=\"progress-value upgrade-progress-value\" id=\"update-progress-vule\" :class=\"{'active': upgradeFailure}\">0%</span>\r\n          <div class=\"ota-progress\">\r\n            <div class=\"ota-progress-progress upgradeProgress\" id=\"update-progress-view\" :class=\"{'active': upgradeFailure}\"></div>\r\n          </div>\r\n          <p class=\"progress-details\">\r\n            <span>{{$t('deviceUpgradingDesc')}}</span>\r\n            <span>{{getBinName()}}</span>\r\n            <span class=\"text-right\">{{timeCost}}</span>\r\n          </p>\r\n          <div v-show=\"!upgradeSuccess && !upgradeFailure\" class=\"result-success\">\r\n            <button @click=\"stopUpgrade\" class=\"btn register-btn\">{{$t('cancelBtn')}}</button>\r\n          </div>\r\n          <div v-show=\"upgradeSuccess\" class=\"result-success\">\r\n            <p>{{$t('upgradeSucDesc')}}</p>\r\n            <div class=\"result-flex\">\r\n              <button @click=\"stopUpgrade\" class=\"btn register-btn retry\">{{$t('cancelBtn')}}</button>\r\n              <button @click=\"otaReboot\" class=\"btn register-btn\">{{$t('confirmBtn')}}</button>\r\n            </div>\r\n          </div>\r\n          <div v-show=\"upgradeFailure\" class=\"result-failure\">\r\n            <p>{{$t('upgradeFailDesc')}}</p>\r\n            <div class=\"result-flex\">\r\n              <button @click=\"retrySave\" class=\"btn register-btn retry\">{{$t('retryBtn')}}</button>\r\n              <button @click=\"otaReboot\" class=\"btn register-btn\">{{$t('confirmBtn')}}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Util from '../assets/tool/utils'\r\nimport Constant from \"../assets/tool/constant\";\r\nimport {MessageBox} from \"mint-ui\";\r\nexport default {\r\n  data () {\r\n    return {\r\n      deviceInfo: this.$store.state.deviceInfo,\r\n      upgradeBinList: [],\r\n      isSelectedVersion: '',\r\n      isSelectedBin: {},\r\n      upgrade: false,\r\n      upgradeValue: 0,\r\n      upgradeSuccess: false,\r\n      upgradeFailure: false,\r\n      timeCost: '00:00:00',\r\n      timeCostId: '',\r\n      scheduleId: ''\r\n    }\r\n  },\r\n  created () {\r\n    var self = this\r\n    window['getOtaBinsCallback'] = (res) => {\r\n      self.getOtaBinsCallback(res)\r\n    }\r\n    window['onBackPressed'] = () => {\r\n      self.onBackPressed()\r\n    }\r\n    window['otaCallback'] = (res) => {\r\n      self.otaCallback(res)\r\n    }\r\n    window['onActivityPause'] = () => {\r\n      self.onActivityPause()\r\n    }\r\n    window['onActivityResume'] = () => {\r\n      self.onActivityResume()\r\n    }\r\n    window['getWiFiInfoCallback'] = (res) => {\r\n      self.getWiFiInfoCallback(res)\r\n    }\r\n  },\r\n  methods: {\r\n    hide () {\r\n      this.$router.goBack()\r\n    },\r\n    // 程序进入后台\r\n    onActivityPause () {\r\n      console.log('程序进入后台')\r\n    },\r\n    // 程序返回前台\r\n    onActivityResume () {\r\n      console.log('程序返回前台')\r\n      EspBleMesh.getWiFiInfo()\r\n    },\r\n    getWiFiInfoCallback (res) {\r\n      var self = this\r\n      var sendOTAStartData = {}\r\n      res = Util.base64().decode(res)\r\n      console.log('FBY OTA getWiFiInfoCallback' + res)\r\n      res = JSON.parse(res)\r\n      if (!Util._isEmpty(res)) {\r\n        if (self.$store.state.otawifiName === res.ssid) {\r\n          sendOTAStartData[Constant.KEY_NAME] = self.isSelectedBin.name\r\n          sendOTAStartData[Constant.KEY_COMPANY_ID] = Constant.VALUE_COMPANY_ID\r\n          sendOTAStartData[Constant.KEY_BIN_ID] = self.isSelectedBin.binId\r\n          sendOTAStartData[Constant.KEY_VERSION_CODE] = self.isSelectedBin.versionCode\r\n          console.log('FBY OTA 开始升级 sendOTAStartData' + JSON.stringify(sendOTAStartData))\r\n          EspBleMesh.startOta(JSON.stringify(sendOTAStartData))\r\n        } else {\r\n          Util.messageRemind(self.$t('wificonnecterror'))\r\n        }\r\n      }\r\n    },\r\n    onBackPressed () {\r\n      this.$router.goBack()\r\n    },\r\n    nodeUpgrade () {\r\n      var self = this\r\n      var sendOTAMeshData = {}\r\n      if (!Util._isEmpty(self.isSelectedBin)) {\r\n        sendOTAMeshData[Constant.KEY_DST_ADDRESS] = self.deviceInfo.address\r\n        sendOTAMeshData[Constant.KEY_COMPANY_ID] = Constant.VALUE_COMPANY_ID\r\n        sendOTAMeshData[Constant.KEY_BIN_ID] = self.isSelectedBin.binId\r\n        sendOTAMeshData[Constant.KEY_VERSION_CODE] = self.isSelectedBin.versionCode\r\n        sendOTAMeshData[Constant.KEY_CLEAR_FLASK] = false\r\n        console.log('FBY OTA 开始升级 sendOTAMeshData' + JSON.stringify(sendOTAMeshData))\r\n        EspBleMesh.sendOtaMeshMessage(JSON.stringify(sendOTAMeshData))\r\n      } else {\r\n        Util.messageRemind(self.$t('updatefile'))\r\n      }\r\n      // self.upgrade = true\r\n      // self.getTime()\r\n      // self.setSchedule()\r\n    },\r\n    setSchedule () {\r\n      var self = this\r\n      self.scheduleId = setInterval(function() {\r\n        console.log(self.upgradeValue)\r\n        if (self.upgradeValue >= 5 || self.upgradeFailure) {\r\n          clearInterval(self.scheduleId)\r\n          self.stopTime()\r\n          self.upgradeFailure = true\r\n        } else {\r\n          self.upgradeValue += 2\r\n          document.getElementById('update-progress-vule').innerText = self.upgradeValue + '%'\r\n          document.getElementById('update-progress-view').style.width = self.upgradeValue + '%'\r\n          // self.setProgress(self.upgradeValue)\r\n        }\r\n      }, 2000)\r\n    },\r\n    // 空白区域取消\r\n    hideUpgrade () {\r\n      if (this.upgradeFailure) {\r\n        this.upgrade = false\r\n        this.upgradeFailure = false\r\n        clearInterval(this.scheduleId)\r\n        // this.showPart = false\r\n        // $(\"span.upgrade-progress-value\").text(\"0%\")\r\n        // $(\"div.upgradeProgress\").css(\"width\", \"0%\")\r\n      }\r\n    },\r\n    // 取消\r\n    stopUpgrade () {\r\n      this.upgrade = false\r\n      this.upgradeFailure = false\r\n      clearInterval(this.scheduleId)\r\n      this.stopTime()\r\n      // this.hideSuccess()\r\n      // this.stopOTA()\r\n    },\r\n    getBinName () {\r\n      if (!Util._isEmpty(this.isSelectedBin)) {\r\n        return this.isSelectedBin.name\r\n      }\r\n      return ''\r\n    },\r\n    // 重试\r\n    retrySave () {\r\n      this.upgrade = false\r\n      this.upgradeFailure = false\r\n      clearInterval(this.scheduleId)\r\n    },\r\n    // 确定\r\n    otaReboot () {\r\n      this.upgrade = false\r\n      this.upgradeFailure = false\r\n      clearInterval(this.scheduleId)\r\n    },\r\n    getTime () {\r\n      var self = this\r\n      self.timeCost = '00:00:00'\r\n      var time = 0\r\n      self.timeCostId = setInterval(function() {\r\n        time ++\r\n        if (time < 60 ) {\r\n          self.timeCost = '00:00:' + self.getSecond(time)\r\n        } else if (time < 3600 ) {\r\n          var m = (time / 60).toFixed(0)\r\n          var s = time % 60\r\n          self.timeCost = '00:' + self.getMinute(m) + ':' + self.getSecond(s)\r\n        } else {\r\n          var h = (time / 3600).toFixed(0)\r\n          var m = (time % 3600 / 60).toFixed(0)\r\n          var s = (time % 60)\r\n          self.timeCost = self.getHour(h) + ':' + self.getMinute(m) + ':' + self.getSecond(s)\r\n        }\r\n      }, 1000)\r\n    },\r\n    getSecond (time) {\r\n      var second = 0\r\n      if (time < 10) {\r\n        second= '0' + time\r\n      } else if (time < 60 ) {\r\n        second = time\r\n      }\r\n      return second\r\n    },\r\n    getMinute (time) {\r\n      var minute = 0\r\n      if (time < 10) {\r\n        minute= '0' + time\r\n      } else if (time < 60 ) {\r\n        minute = time\r\n      }\r\n      return minute\r\n    },\r\n    getHour (time) {\r\n      var hour = 0\r\n      if (time < 10) {\r\n        hour= '0' + time\r\n      } else {\r\n        hour = time\r\n      }\r\n      return hour\r\n    },\r\n    stopTime () {\r\n      var self = this\r\n      clearInterval(self.timeCostId)\r\n    },\r\n    // 升级文件\r\n    switchUpgradeBin (item) {\r\n      var self = this\r\n      console.log('选择升级文件版本： ' + item.name)\r\n      if (self.isSelectedVersion !== item.name) {\r\n        self.isSelectedVersion = item.name\r\n        self.isSelectedBin = item\r\n      }\r\n    },\r\n    isUpgradeSelected (name) {\r\n      // console.log('选择升级版本： ' + version)\r\n      var self = this\r\n      var flag = false\r\n      if (self.isSelectedVersion === name) {\r\n        flag = true\r\n      }\r\n      return flag\r\n    },\r\n    getOtaBinsCallback (res) {\r\n      var self = this\r\n      res = Util.base64().decode(res)\r\n      console.log('FBY OTA getOtaBinsCallback' + res)\r\n      res = JSON.parse(res)\r\n      if (!Util._isEmpty(res)) {\r\n        self.upgradeBinList = res\r\n      }\r\n    },\r\n    otaCallback (res) {\r\n      var self = this\r\n      res = Util.base64().decode(res)\r\n      console.log('FBY OTA otaCallback' + res)\r\n      res = JSON.parse(res)\r\n      if (!Util._isEmpty(res)) {\r\n        if (res.status === Constant.OTA_STATUS_MESSAGE_NOT_NEED) {\r\n          Util.messageRemind(self.$t('notneedupdate'))\r\n        } else if (res.status === Constant.OTA_STATUS_MESSAGE_TIMEOUT) {\r\n        } else if (res.status === Constant.OTA_STATUS_MESSAGE_READY) {\r\n          console.log('链接Wi-Fi')\r\n          self.$store.commit('setotawifiName', res.ssid)\r\n          MessageBox({\r\n            $type: 'alert',\r\n            title: self.$t('switchnetwork'),\r\n            message: 'SSID: ' + res.ssid + '\\n' + ' PASSWORD: ' + res.password,\r\n            showConfirmButton: false,\r\n            closeOnClickModal: false,\r\n            showCancelButton: true,\r\n            cancelButtonText: self.$t('settings')\r\n          }).then(action => {\r\n            console.log('点击设置按钮')\r\n            EspBleMesh.gotoSystemSettings('wifi')\r\n            // self.removeDevices()\r\n            // self.backHome(res.node)\r\n          })\r\n        } else if (res.status === Constant.OTA_STATUS_COMPLETE) {\r\n          console.log('升级完成')\r\n        } else if (res.status === Constant.OTA_STATUS_CONNECTED) {\r\n          console.log('建立升级链接')\r\n        } else if (res.status === Constant.OTA_STATUS_PROGRESS) {\r\n          console.log('升级中' + res.progress)\r\n        }\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    var self = this\r\n    console.log('mounted 走了 deviceInfo' + JSON.stringify(self.deviceInfo))\r\n    EspBleMesh.getOtaBins()\r\n    // self.upgradeBinList = [{'name': 'Node_Bin_v1.0.10', 'appVersionName': '1.0.10'}, {'name': 'Node_Bin_v1.0.9', 'appVersionName': '1.0.9'},\r\n    //   {'name': 'Node_Bin_v1.0.8', 'appVersionName': '1.0.8'}, {'name': 'Node_Bin_v1.0.7', 'appVersionName': '1.0.7'}, {'name': 'Node_Bin_v1.0.6', 'appVersionName': '1.0.6'},\r\n    //   {'name': 'Node_Bin_v1.0.5', 'appVersionName': '1.0.5'}, {'name': 'Node_Bin_v1.0.4', 'appVersionName': '1.0.4'}, {'name': 'Node_Bin_v1.0.3', 'appVersionName': '1.0.3'},\r\n    //   {'name': 'Node_Bin_v1.0.2', 'appVersionName': '1.0.2'}, {'name': 'Node_Bin_v1.0.1', 'appVersionName': '1.0.1'}, {'name': 'Node_Bin_v1.0.0', 'appVersionName': '1.0.0'}]\r\n  },\r\n  activated () {\r\n    console.log('activated 走了')\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  @import '../assets/css/index.less';\r\n  .upgrade-base {\r\n    position: relative;\r\n    top: 50px;\r\n    height: calc(100% - 50px) !important;\r\n  }\r\n  .ota-upgrade {\r\n    position: absolute;\r\n    top: 0;\r\n    bottom: 0;\r\n    width: 100%;\r\n    z-index: 200;\r\n  }\r\n  .ota-upgrade .mask {\r\n    height: 100%;\r\n    width: 100%;\r\n    background: rgba(0, 0, 0, .6);\r\n  }\r\n  .upgrade-info {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    width: 88%;\r\n    max-width: 550px;\r\n    background: #fff;\r\n    border-radius: 5px;\r\n    padding: 10px 20px;\r\n    -webkit-transform: translate3d(-50%, -50%, 0);\r\n    transform: translate3d(-50%, -50%, 0);\r\n    box-sizing: border-box;\r\n  }\r\n  .upgrade-info h3 {\r\n    position: relative;\r\n    text-align: center;\r\n  }\r\n  .upgrade-details {\r\n    position: absolute;\r\n    right: 0;\r\n    color: #fa2d28;\r\n  }\r\n  .upgrade-details-info {\r\n    max-height: 200px;\r\n    overflow: hidden;\r\n    overflow-y: auto;\r\n    margin-bottom: 10px;\r\n  }\r\n  .details-item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    border-top: 1px solid #e6e6e6;\r\n    padding: 6px;\r\n  }\r\n  .progress-info {\r\n    margin: 20px 0;\r\n  }\r\n  .progress-info span {\r\n    position: relative;\r\n    bottom: -3px;\r\n    color: #fa2d28;\r\n  }\r\n  .progress-info span.active {\r\n    color: #999;\r\n  }\r\n  .progress-info p {\r\n    color: #858585;\r\n  }\r\n  .upgrade-progress-value {\r\n    display: inline-block;\r\n    -webkit-transform: translate(-35%, 0);\r\n    transform: translate(-35%, 0);\r\n    transition: all .3s linear;\r\n  }\r\n  .ota-progress {\r\n    margin-top: 5px;\r\n    width: 100%;\r\n    height: 10px;\r\n    border: none;\r\n    background: #ebebeb;\r\n    border-radius: 5px;\r\n  }\r\n  .ota-progress-progress {\r\n    background-color: #fa2d28;\r\n    border-radius: 5px;\r\n    height: 100%;\r\n    width: 0;\r\n    -webkit-transition: all .3s linear;\r\n    transition: all .3s linear;\r\n  }\r\n  .ota-progress-progress.active {\r\n    background-color: #999;\r\n  }\r\n  .progress-details {\r\n    display: flex;\r\n    align-items: center;\r\n    margin: 10px 0;\r\n  }\r\n  .progress-details span {\r\n    flex: 1;\r\n    color: #858585;\r\n    font-size: 12px;\r\n  }\r\n  .result-success p,\r\n  .result-failure p {\r\n    margin: 10px 0;\r\n    color: #fa2d28;\r\n    font-size: 12px;\r\n  }\r\n  .btn {\r\n    display: inline-block;\r\n    padding: 12px;\r\n    font-size: 14px;\r\n    width: 100%;\r\n    min-width: 100px;\r\n    margin: 0 auto;\r\n    color: #fff;\r\n    border-radius: 5px;\r\n    -webkit-transition: all .3s linear;\r\n    transition: all .3s linear;\r\n  }\r\n  .register-btn {\r\n    background: #fa2d28;\r\n    border: 1px solid #fa2d28;\r\n  }\r\n  .result-flex {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n  .result-flex button:first-child {\r\n    margin-right: 5px;\r\n  }\r\n  .retry {\r\n    color: #656b79;\r\n    background-color: #f6f8fa;\r\n    border-color: #f6f8fa;\r\n  }\r\n  .text-right {\r\n    text-align: right;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/pages/OTAUpgrade.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content-box\"},[_c('div',{staticClass:\"title-info\"},[_c('h4',{staticClass:\"app-title\"},[_c('span',{on:{\"click\":_vm.hide}},[_c('i',{staticClass:\"icon-left back\"})]),_vm._v(_vm._s(_vm.deviceInfo.name))]),_vm._v(\" \"),_c('span',{staticClass:\"right-top-text\",on:{\"click\":function($event){return _vm.nodeUpgrade()}}},[_vm._v(_vm._s(_vm.$t('upgrade')))])]),_vm._v(\" \"),_c('div',{staticClass:\"content-info flex-wrapper upgrade-base\"},[_c('div',{staticClass:\"overflow-touch\"},_vm._l((_vm.upgradeBinList),function(item){return _c('div',{key:item.name,staticClass:\"item\",on:{\"click\":function($event){return _vm.switchUpgradeBin(item)}}},[_c('div',{staticClass:\"item-name\"},[_c('span',[_vm._v(_vm._s(item.name))]),_vm._v(\" \"),_c('span',{staticClass:\"desc\"},[_vm._v(_vm._s(item.versionName))])]),_vm._v(\" \"),_c('div',{staticClass:\"item-power-small\"},[_c('span',{staticClass:\"span-radio\",class:{'active': _vm.isUpgradeSelected(item.name)},attrs:{\"data-value\":item.name}},[_c('span')])])])}),0)]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgrade),expression:\"upgrade\"}],staticClass:\"ota-upgrade\"},[_c('div',{staticClass:\"mask\",on:{\"click\":_vm.hideUpgrade}}),_vm._v(\" \"),_c('div',{staticClass:\"upgrade-info\"},[_c('h3',[_vm._v(_vm._s(_vm.$t('otaUpdate')))]),_vm._v(\" \"),_c('div',{staticClass:\"progress-info\"},[_c('span',{staticClass:\"progress-value upgrade-progress-value\",class:{'active': _vm.upgradeFailure},style:({'left': _vm.upgradeValue + '%'}),attrs:{\"id\":\"update-progress-vule\"}},[_vm._v(\"0%\")]),_vm._v(\" \"),_c('div',{staticClass:\"ota-progress\"},[_c('div',{staticClass:\"ota-progress-progress upgradeProgress\",class:{'active': _vm.upgradeFailure},attrs:{\"id\":\"update-progress-view\"}})]),_vm._v(\" \"),_c('p',{staticClass:\"progress-details\"},[_c('span',[_vm._v(_vm._s(_vm.$t('deviceUpgradingDesc')))]),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.getBinName()))]),_vm._v(\" \"),_c('span',{staticClass:\"text-right\"},[_vm._v(_vm._s(_vm.timeCost))])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.upgradeSuccess && !_vm.upgradeFailure),expression:\"!upgradeSuccess && !upgradeFailure\"}],staticClass:\"result-success\"},[_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.stopUpgrade}},[_vm._v(_vm._s(_vm.$t('cancelBtn')))])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgradeSuccess),expression:\"upgradeSuccess\"}],staticClass:\"result-success\"},[_c('p',[_vm._v(_vm._s(_vm.$t('upgradeSucDesc')))]),_vm._v(\" \"),_c('div',{staticClass:\"result-flex\"},[_c('button',{staticClass:\"btn register-btn retry\",on:{\"click\":_vm.stopUpgrade}},[_vm._v(_vm._s(_vm.$t('cancelBtn')))]),_vm._v(\" \"),_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.otaReboot}},[_vm._v(_vm._s(_vm.$t('confirmBtn')))])])]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.upgradeFailure),expression:\"upgradeFailure\"}],staticClass:\"result-failure\"},[_c('p',[_vm._v(_vm._s(_vm.$t('upgradeFailDesc')))]),_vm._v(\" \"),_c('div',{staticClass:\"result-flex\"},[_c('button',{staticClass:\"btn register-btn retry\",on:{\"click\":_vm.retrySave}},[_vm._v(_vm._s(_vm.$t('retryBtn')))]),_vm._v(\" \"),_c('button',{staticClass:\"btn register-btn\",on:{\"click\":_vm.otaReboot}},[_vm._v(_vm._s(_vm.$t('confirmBtn')))])])])])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-51052966\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/OTAUpgrade.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-51052966\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./OTAUpgrade.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./OTAUpgrade.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./OTAUpgrade.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-51052966\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./OTAUpgrade.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-51052966\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/OTAUpgrade.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}